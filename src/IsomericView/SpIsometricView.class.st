Class {
	#name : #SpIsometricView,
	#superclass : #SpPresenter,
	#instVars : [
		'menu',
		'projectorList',
		'renderer',
		'form',
		'viewerPane',
		'viewerToolbar',
		'objectToolbar',
		'objectTable',
		'selectedObjects',
		'status',
		'optionsPane'
	],
	#category : #'IsomericView-Spec2'
}

{ #category : #accessing }
SpIsometricView class >> descriptionText [

	^ 'A tool to build isometric view image.'
]

{ #category : #accessing }
SpIsometricView class >> icon [

	^ self iconNamed: #box
]

{ #category : #'world menu' }
SpIsometricView class >> menuCommandOn: aBuilder [

	<worldMenu>
	(aBuilder item: 'Isometric View Editor')
		action: [ self new open ];
		order: 10;
		parent: #Tools;
		help: self descriptionText;
		icon: self icon
]

{ #category : #actions }
SpIsometricView >> addNewObject [

	| list ret newObj objects |
	list := self objectTypes.
	ret := self uiManager chooseFrom: list.
	ret = 0 ifTrue: [ ^ self ].
	newObj := (Smalltalk globals at: (list at: ret)) new.
	objects := objectTable items asOrderedCollection.
	objectTable selectionMode isEmpty
		ifTrue: [ objects add: newObj ]
		ifFalse: [ objects add: newObj after: objectTable selectedItem ].
	objectTable items: objects.
	selectedObjects add: newObj
]

{ #category : #constants }
SpIsometricView >> appName [

	^ 'Isometric View Editor'
]

{ #category : #forms }
SpIsometricView >> appicons [
^ (Form
	extent: (64@64)
	depth: 32
	fromArray: #( 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 117506305 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 0 117506305 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 33620225 0 0 0 0 0 0 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 0 0 0 0 0 0 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 33620225 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4294967295 4278190080 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 16777473 4294967295 4294967295 4294967295 4294967295 16777473 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 0 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 67305987 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 0 4294967295 4278190080 4278190080 4294967295 0 4294967295 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 252381188 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 16842753 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 100729089 0 0 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 67305987 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4294967295 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 4294967295 4294967295 0 4294967295 4278190080 4278190080 4294967295 0 4294967295 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4294967295 4278190080 4278190080 4294967295 4278190080 4294967295 4278190080 4278190080 4294967295 4294967295 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 16842753 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 0 0 0 0 0 0 0 67305987 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4278190080 4294967295 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4289374890 4289374890 4289374890 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4294967295 4278190080 4289374890 4289374890 4289374890 4278190080 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4278190080 4294967295 4278190080 4289374890 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4278190080 4278190080 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4278190080 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4278190080 4294967295 0 4294967295 4278190080 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 4294967295 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4278190080 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)
	offset: (0@0))
]

{ #category : #'instance creation' }
SpIsometricView >> buildTableMenu [

	^ self newMenu
		  addItem: [ :anItem |
			  anItem
				  name: 'inspect';
				  action: [ objectTable selectedItem inspect ] ];
		  yourself
]

{ #category : #actions }
SpIsometricView >> changeBackgroundColor [

	| ret |
	ret := self uiManager chooseColor: self viewerMorph color.
	ret ifNil: [ ^ self ].
	self viewerMorph color: ret.
	self updateForm
]

{ #category : #private }
SpIsometricView >> changeOptionsPaneTo: anOption [

	optionsPane removeAll.
	anOption ifNil: [ ^ self ].
	optionsPane add: anOption
]

{ #category : #actions }
SpIsometricView >> changeOutlineColor [

	| ret |
	ret := self uiManager chooseColor: renderer lineColor.
	ret ifNil: [ ^ self ].
	renderer lineColor: ret.
	self updateForm
]

{ #category : #actions }
SpIsometricView >> changeProjector: aSymbol [

	renderer projector:
		(renderer projector perform: ('as' , aSymbol) asSymbol).
	self updateForm
]

{ #category : #private }
SpIsometricView >> clearSelectedObjects [

	selectedObjects := Set new
]

{ #category : #defaults }
SpIsometricView >> defaultBackgroundColor [

	^ Color veryLightGray
]

{ #category : #defaults }
SpIsometricView >> defaultFormExtent [

	^ 240 @ 240
]

{ #category : #layout }
SpIsometricView >> defaultLayout [

	^ SpBoxLayout newVertical
		  add: menu
		  withConstraints: [ :c | c height: self class toolbarHeight ];
		  add: (SpPanedLayout newHorizontal
				   add: (SpBoxLayout newVertical
						    add: viewerToolbar expand: false;
						    add: viewerPane;
						    add: projectorList expand: false;
						    yourself);
				   add: (SpBoxLayout newVertical
						    add: objectToolbar expand: false;
						    add: (SpPanedLayout newVertical
								     add: objectTable;
								     add: optionsPane;
								     yourself);
						    yourself);
				   yourself);
		  yourself
]

{ #category : #defaults }
SpIsometricView >> defaultLineColor [

	^ Color darkGray
]

{ #category : #defaults }
SpIsometricView >> defaultProjector [

	^ IVPixelartProjector new
]

{ #category : #defaults }
SpIsometricView >> defaultRenderer [

	^ IVRendererMixer new
		  projector: self defaultProjector;
		  lineColor: self defaultLineColor;
		  yourself
]

{ #category : #defaults }
SpIsometricView >> defaultViewerScale [

	^ 2 @ 2
]

{ #category : #actions }
SpIsometricView >> deleteObject [

	| obj list |
	objectTable selectionMode isEmpty ifTrue: [ ^ self ].
	obj := objectTable selectedItem.
	list := objectTable items asOrderedCollection.
	list remove: obj.
	objectTable items: list.
	self updateForm
]

{ #category : #actions }
SpIsometricView >> duplicateObject [

	| list newItem |
	objectTable selectedItem ifNil: [ ^ self ].
	list := objectTable items asOrderedCollection.
	newItem := objectTable selectedItem deepCopy.
	list add: newItem after: objectTable selectedItem.
	self updateObjects
]

{ #category : #actions }
SpIsometricView >> editForm [

	| obj |
	objectTable selectionMode isEmpty ifTrue: [ ^ self ].
	obj := objectTable selectedItem.
	obj form ifNil: [ obj form: (self formForObject: obj) ].
	self newEditorApp
		useForm: obj form notifying: [ :f |
			obj form: f.
			self updateObjects ];
		open
]

{ #category : #actions }
SpIsometricView >> exportFile [

	| ret |
	form ifNil: [ ^ self ].
	ret := self uiManager
		       chooseForSaveFileReference: 'Export file ...'
		       extensions: { 'png'. 'gif' }
		       path: (status lastImportedFile ifNil: [
				        FileSystem workingDirectory / 'Unnamed.png' ]).
	ret ifNil: [ ^ self ].
	ret extension = 'gif'
		ifTrue: [ GIFReadWriter putForm: form onFileNamed: ret ]
		ifFalse: [
			ret extension = 'png' ifFalse: [ ret := ret withExtension: 'png' ].
			PNGReadWriter putForm: form onFileNamed: ret ].
	status lastImportedFile: ret asFileReference
]

{ #category : #initialization }
SpIsometricView >> fileMenu [

	| m |
	m := self newMenu.
	m addGroup: [ :grp |
		grp
			addItem: [ :item |
				item
					name: 'New' localized;
					action: [ self newProject ] ];
			addItem: [ :item |
				item
					name: 'Open' localized;
					action: [ self openProject ] ];
			addItem: [ :item |
				item
					name: 'Open class ...' localized;
					action: [ self openFromClass ] ];
			addItem: [ :item |
				item
					name: 'Save' localized;
					action: [ self saveProjectNoDialog ] ];
			addItem: [ :item |
				item
					name: 'Save As' localized;
					action: [ self saveProject ] ] ].
	m addGroup: [ :grp |
		grp addItem: [ :item |
			item
				name: 'Export as file' localized;
				action: [ self exportFile ] ] ].
	m addGroup: [ :grp |
		grp addItem: [ :item |
			item
				name: 'Close' localized;
				action: [ self window close ] ] ].
	^ m
]

{ #category : #private }
SpIsometricView >> fixObjects [

	"objectTable items do: [ :each |
		(each isKindOf: IVPlane) ifTrue: [ each surfaceToMaterial ] ]"
]

{ #category : #constants }
SpIsometricView >> formButtonLabel [

	^ 'Form' localized
]

{ #category : #api }
SpIsometricView >> formForObject: anIVObject [

	| form1 form2 rect |
	renderer drawingRange: nil.
	form1 := Form extent: form extent depth: form depth.
	renderer render: { anIVObject } onForm: form1.
	rect := renderer drawingRange.
	form2 := form contentsOfArea: (rect extendBy: (0 @ 0 extent: 1 @ 1)).
	form2 offset:
		rect origin - (renderer ivPointToPoint: anIVObject origin).
	^ form2
]

{ #category : #initialization }
SpIsometricView >> helpMenu [

	^ self newMenu
		  addItem: [ :item | 
			  item
				  name: ('About ' , self appName) localized;
				  action: [ owner window showAbout ] ];
		  addItem: [ :item | 
			  item
				  name: 'Inspect';
				  action: [ self inspect ] ];
		  yourself
]

{ #category : #api }
SpIsometricView >> iconAt: aPoint [

	^ self appicons contentsOfArea:
		  (Rectangle
			   origin: aPoint * self iconExtent
			   extent: self iconExtent)
]

{ #category : #constants }
SpIsometricView >> iconExtent [

	^ 16 @ 16
]

{ #category : #initialization }
SpIsometricView >> initialize [

	renderer := self defaultRenderer.
	form := self newForm.
	selectedObjects := Set new.
	status := self newStatus.
	super initialize
]

{ #category : #initialization }
SpIsometricView >> initializePresenters [

	menu := self newMenuBar.
	viewerToolbar := self newToolbar.
	viewerPane := self newMorph
		              morph: self newViewerMorph;
		              yourself.
	objectToolbar := self newToolbar.
	objectTable := self newTable.
	projectorList := self newDropList.
	optionsPane := SpBoxLayout newTopToBottom.
	self setupMenu.
	self setupToolbar.
	self setupList.
	self setupTable
]

{ #category : #initialization }
SpIsometricView >> initializeWindow: aWindow [

	aWindow initialExtent: 1024 @ 764
]

{ #category : #actions }
SpIsometricView >> inputFormHeight [

	| ret h |
	ret := self uiManager
		       request: 'Input form height' localized
		       initialAnswer: form height asString.
	(ret isNil or: [ ret isEmpty ]) ifTrue: [ ^ self ].
	h := 0.
	[ h := ret asInteger ]
		on: Error
		do: [ ^ self inform: 'Invalid value' ].
	h <= 0 ifTrue: [ ^ self ].
	form := Form extent: form width @ h depth: 32.
	self updateForm
]

{ #category : #actions }
SpIsometricView >> inputFormWidth [

	| ret w |
	ret := self uiManager
		       request: 'Input form width' localized
		       initialAnswer: form width asString.
	(ret isNil or: [ ret isEmpty ]) ifTrue: [ ^ self ].
	w := 0.
	[ w := ret asInteger ]
		on: Error
		do: [ ^ self inform: 'Invalid value' ].
	w <= 0 ifTrue: [ ^ self ].
	form := Form extent: w @ form height depth: 32.
	self updateForm
]

{ #category : #actions }
SpIsometricView >> moveDown [

	| obj list index |
	objectTable selectionMode isEmpty ifTrue: [ ^ self ].
	obj := objectTable selectedItem.
	list := objectTable items.
	index := list indexOf: obj.
	index > (list size - 1) ifTrue: [ ^ self ].
	list swap: index with: index + 1.
	objectTable items: list.
	objectTable selectItem: obj.
	self updateForm
]

{ #category : #actions }
SpIsometricView >> moveUp [

	| obj list index |
	objectTable selectionMode isEmpty ifTrue: [ ^ self ].
	obj := objectTable selectedItem.
	list := objectTable items.
	index := list indexOf: obj.
	index < 2 ifTrue: [ ^ self ].
	list swap: index with: index - 1.
	objectTable items: list.
	objectTable selectItem: obj.
	self updateForm
]

{ #category : #'instance creation' }
SpIsometricView >> newEditorApp [

	^ SpPixelArtEditor new
]

{ #category : #'instance creation' }
SpIsometricView >> newForm [

	^ Form extent: self defaultFormExtent depth: 32
]

{ #category : #actions }
SpIsometricView >> newProject [

	renderer := self defaultRenderer.
	form := self newForm.
	selectedObjects := Set new.
	status := self newStatus.
	self objects: #(  ).
	self selectListItem.
	self updateForm.
	status
		lastImportedFile: nil;
		lastProjectFile: nil.
	self setWindowTitle
]

{ #category : #'instance creation' }
SpIsometricView >> newStatus [

	^ IVStatus new
]

{ #category : #'instance creation' }
SpIsometricView >> newViewerMorph [

	^ PAViewerMorph new
		  scale: self defaultViewerScale;
		  color: self defaultBackgroundColor;
		  form: form;
		  yourself
]

{ #category : #constants }
SpIsometricView >> objectTypes [

	^ #( IVBox IVHole IVCircle IVCylinder IVPolyhedron IVRectangle )
]

{ #category : #accessing }
SpIsometricView >> objects [

	^ objectTable items
]

{ #category : #accessing }
SpIsometricView >> objects: aCollection [

	objectTable items: aCollection.
	self clearSelectedObjects.
	selectedObjects addAll: aCollection
]

{ #category : #actions }
SpIsometricView >> openFromClass [

	| dialog class obj |
	dialog := SpFilteringListPresenter new.
	dialog items:
		(IVScene allSubclasses asArray sorted: [ :a :b | a name <= b name ]).
	dialog openModal.
	class := dialog selectedItem.
	class ifNil: [ ^ self ].
	obj := class new.
	self objects: obj objects.
	self resetToolbarButton.
	self updateForm.
	status lastProjectFile: nil
]

{ #category : #actions }
SpIsometricView >> openProject [

	| ret dict objects |
	ret := self uiManager chooseFullFileNameMatching:
		       { ('*.' , self projectExtension) }.
	ret ifNil: [ ^ self ].
	dict := STON fromString: ret asFileReference readStream contents.
	dict isDictionary ifFalse: [ ^ self error: 'invalid project file' ].
	status := self newStatus.
	renderer := (dict at: #renderer) asRendererMixer.
	form := dict at: #form.
	objects := dict at: #objects.
	objectTable items: objects.
	selectedObjects := (dict
		                    at: #selected
		                    ifPresent: [ :set |
		                    set collect: [ :each | objects at: each ] ]
		                    ifAbsent: [ objects ]) asSet.
	self fixObjects.
	self selectListItem.
	self resetToolbarButton.
	self updateForm.
	status lastProjectFile: ret asFileReference.
	self setWindowTitle
]

{ #category : #constants }
SpIsometricView >> optionsHeight [

	^ 200
]

{ #category : #constants }
SpIsometricView >> outlineButtonLabel [

	^ 'Outline' localized
]

{ #category : #constants }
SpIsometricView >> projectExtension [

	^ 'ive'
]

{ #category : #actions }
SpIsometricView >> rebuildAllForms [

	| f |
	objectTable items do: [ :each |
		each isImage ifFalse: [
			f := self formForObject: each.
			each form: f ] ]
]

{ #category : #accessing }
SpIsometricView >> renderer [

	^ renderer
]

{ #category : #accessing }
SpIsometricView >> renderer: anObject [

	renderer := anObject
]

{ #category : #actions }
SpIsometricView >> resetColor [

	self viewerMorph color: self defaultBackgroundColor.
	renderer lineColor: self defaultLineColor
]

{ #category : #actions }
SpIsometricView >> resetForm [

	| obj |
	objectTable selectionMode isEmpty ifTrue: [ ^ self ].
	obj := objectTable selectedItem.
	obj form ifNil: [ ^ self ].
	obj isImage ifTrue: [
		^ self inform: 'You cannot reset form of the Image object.' localized ].
	(self confirm: 'Reset the form of that object?' localized) ifFalse: [
		^ self ].
	obj form: nil.
	self updateObjects
]

{ #category : #private }
SpIsometricView >> resetToolbarButton [

	(viewerToolbar itemNamed: self outlineButtonLabel) setSelection:
		renderer drawOutline.
	(viewerToolbar itemNamed: self formButtonLabel) setSelection:
		renderer drawForm
]

{ #category : #actions }
SpIsometricView >> saveProject [

	| ret |
	ret := self uiManager
		       chooseForSaveFileReference: 'Save project ...'
		       extensions: { self projectExtension }
		       path: (status lastProjectFile ifNil: [
				        FileSystem workingDirectory
				        / ('Unnamed.' , self projectExtension) ]).
	ret ifNil: [ ^ self ].
	self saveProjectAs: ret asFileReference
]

{ #category : #private }
SpIsometricView >> saveProjectAs: aFileReference [

	| dict text |
	dict := Dictionary new.
	dict at: #objects put: objectTable items.
	dict at: #renderer put: renderer.
	dict at: #form put: form.
	dict at: #selected put: self selectedObjectIndexes.
	text := STON toString: dict.
	aFileReference exists ifTrue: [ aFileReference delete ].
	aFileReference writeStreamDo: [ :stream | stream nextPutAll: text ].
	status lastProjectFile: aFileReference.
	self setWindowTitle
]

{ #category : #actions }
SpIsometricView >> saveProjectNoDialog [

	status lastProjectFile ifNil: [ ^ self saveProject ].
	self saveProjectAs: status lastProjectFile
]

{ #category : #actions }
SpIsometricView >> selectAllObjects [

	selectedObjects := self objects asSet.
	self updateObjects
]

{ #category : #private }
SpIsometricView >> selectListItem [

	projectorList selectItem: renderer projector name
]

{ #category : #actions }
SpIsometricView >> selectNoObjects [

	self clearSelectedObjects.
	self updateObjects
]

{ #category : #private }
SpIsometricView >> selectTableItem: aSelectionMode [

	| obj presenter |
	aSelectionMode isEmpty ifTrue: [ ^ self changeOptionsPaneTo: nil ].
	obj := aSelectionMode selectedItem.
	presenter := obj asPresenter.
	obj hasSurface ifTrue: [ presenter updateSurface: renderer ].
	self changeOptionsPaneTo: presenter
]

{ #category : #private }
SpIsometricView >> selectedObjectIndexes [

	| list |
	list := objectTable items asArray.
	^ selectedObjects collect: [ :each | list indexOf: each ]
]

{ #category : #private }
SpIsometricView >> setWindowTitle [

	| title |
	title := status lastProjectFile
		         ifNil: [ self appName ]
		         ifNotNil: [ :file | self appName , ' - ' , file basename ].
	self window title: title
]

{ #category : #initialization }
SpIsometricView >> setupList [

	projectorList
		items: { #PixelartProjector. #NormalProjector. #ParallelProjector };
		display: [ :each | each ];
		whenSelectedItemChangedDo: [ :each | self changeProjector: each ]
]

{ #category : #initialization }
SpIsometricView >> setupMenu [

	menu
		addItem: [ :item |
			item
				name: 'File' localized;
				subMenu: self fileMenu ];
		addItem: [ :item |
			item
				name: 'View' localized;
				subMenu: self viewMenu ];
		addItem: [ :item |
			item
				name: 'Tools' localized;
				subMenu: self toolsMenu ];
		addItem: [ :item |
			item
				name: 'Help' localized;
				subMenu: self helpMenu ]
]

{ #category : #initialization }
SpIsometricView >> setupTable [

	objectTable
		contextMenu: self buildTableMenu;
		whenSelectionChangedDo: [ :item | self selectTableItem: item ];
		addColumn: ((SpCheckBoxTableColumn
				  title: ' '
				  evaluated: [ :item | selectedObjects includes: item ])
				 onActivation: [ :class |
					 selectedObjects add: class.
					 self updateForm ];
				 onDeactivation: [ :class |
					 selectedObjects remove: class.
					 self updateForm ];
				 width: 20;
				 yourself);
		addColumn: (SpStringTableColumn title: 'Name' evaluated: #label);
		addColumn: (SpStringTableColumn title: 'Type' evaluated: #class);
		addColumn:
		(SpStringTableColumn title: 'Origin' evaluated: #originValue);
		addColumn:
		(SpStringTableColumn title: 'Extent' evaluated: #extentValue)
]

{ #category : #initialization }
SpIsometricView >> setupToolbar [

	viewerToolbar
		addItem: (self newToolbarButton
				 label: 'New' localized;
				 help: 'New project';
				 icon: (self iconAt: 1 @ 2);
				 action: [ self newProject ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Open' localized;
				 help: 'Open project';
				 icon: (self iconAt: 2 @ 2);
				 action: [ self openProject ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Save' localized;
				 help: 'Save project';
				 icon: (self iconAt: 0 @ 3);
				 action: [ self saveProject ];
				 yourself);
		addItem: (self newToolbarToggleButton
				 label: self outlineButtonLabel;
				 help: 'Show outline';
				 icon: (self iconAt: 3 @ 2);
				 state: renderer drawOutline;
				 action: [
					 renderer drawOutline: renderer drawOutline not.
					 self updateForm ];
				 yourself);
		addItem: (self newToolbarToggleButton
				 label: self formButtonLabel;
				 help: 'Show form';
				 icon: (self iconAt: 1 @ 3);
				 state: renderer drawForm;
				 action: [
					 renderer drawForm: renderer drawForm not.
					 self updateForm ];
				 yourself).
	objectToolbar
		addItem: (self newToolbarButton
				 label: 'All' localized;
				 help: 'Select all objects';
				 icon: (self iconAt: 0 @ 0);
				 action: [ self selectAllObjects ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'None' localized;
				 help: 'Clear selected objects';
				 icon: (self iconAt: 1 @ 0);
				 action: [ self selectNoObjects ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Add' localized;
				 help: 'Add new object';
				 icon: (self iconAt: 2 @ 0);
				 action: [ self addNewObject ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Dup' localized;
				 help: 'Duplicate object';
				 icon: (self iconAt: 3 @ 0);
				 action: [ self duplicateObject ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Up' localized;
				 help: 'Move up the object';
				 icon: (self iconAt: 0 @ 1);
				 action: [ self moveUp ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Down' localized;
				 help: 'Move down the object';
				 icon: (self iconAt: 1 @ 1);
				 action: [ self moveDown ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Edit' localized;
				 help: 'Edit form of the object';
				 icon: (self iconAt: 3 @ 1);
				 action: [ self editForm ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Reset' localized;
				 help: 'Reset form of the object';
				 icon: (self iconAt: 0 @ 2);
				 action: [ self resetForm ];
				 yourself);
		addItem: (self newToolbarButton
				 label: 'Delete' localized;
				 help: 'Delete the object';
				 icon: (self iconAt: 2 @ 1);
				 action: [ self deleteObject ];
				 yourself)
]

{ #category : #initialization }
SpIsometricView >> toolsMenu [

	^ self newMenu
		  addGroup: [ :grp |
			  grp
				  addItem: [ :item |
					  item
						  name: 'Set width' localized;
						  action: [ self inputFormWidth ] ];
				  addItem: [ :item |
					  item
						  name: 'Set height' localized;
						  action: [ self inputFormHeight ] ] ];
		  addGroup: [ :grp |
			  grp
				  addItem: [ :item |
					  item
						  name: 'Rebuild all forms' localized;
						  action: [ self rebuildAllForms ] ] ];
		  yourself
]

{ #category : #private }
SpIsometricView >> updateForm [

	| objects |
	renderer extent: form extent.
	objects := self objects select: [ :each |
		           selectedObjects includes: each ].
	form := renderer render: objects.
	self viewerMorph
		form: form;
		changed
]

{ #category : #private }
SpIsometricView >> updateObjects [

	objectTable items: self objects.
	self updateForm
]

{ #category : #initialization }
SpIsometricView >> viewMenu [

	^ self newMenu
		  addGroup: [ :grp |
			  grp
				  addItem: [ :item |
					  item
						  name: 'Change background color' localized;
						  action: [ self changeBackgroundColor ] ];
				  addItem: [ :item |
					  item
						  name: 'Change outline color' localized;
						  action: [ self changeOutlineColor ] ];
				  addItem: [ :item |
					  item
						  name: 'Reset color' localized;
						  action: [ self resetColor ] ] ];
		  addGroup: [ :grp |
			  grp
				  addItem: [ :item |
					  item
						  name: 'Normal size' localized;
						  action: [ self setNormalSize ] ];
				  addItem: [ :item |
					  item
						  name: 'Bigger size' localized;
						  action: [ self setLargeSize ] ] ];
		  addGroup: [ :grp |
			  grp addItem: [ :item |
				  item
					  name: 'Show form info' localized;
					  action: [ self showFormInfo ] ] ];
		  yourself
]

{ #category : #accessing }
SpIsometricView >> viewerMorph [

	^ viewerPane morph
]
